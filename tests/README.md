
План блочного тестирования.

| ID  | Описание теста | Объект тестирования | Входные данные | Ожидаемый результат |
|-----|----------------|---------------------|----------------|---------------------|
| Б1  | Проверка статуса подписки пользователя | check_subscription | chat_id = "test_chat_1", api_key = "test_api_key", subscription = "free", затем "pro" после обновления | Возвращается True для "free", False для "pro" до обновления; True для обоих после обновления на "pro" |
| Б2  | Проверка наличия достаточного количества токенов | is_enough_tokens | chat_id = "test_chat_2", api_key = "test_api_key" | Возвращается True для достаточного количества токенов |
| Б3  | Проверка обновления статуса подписки | update_subscription_status | chat_id = "test_chat_5", api_key = "test_api_key", subscription = "pro", затем "free" | Статус подписки обновляется до "pro", затем до "free" |
| Б4 | Проверка создания диалога в базе данных | create_dialog | chat_id = "test_chat_1", api_key = "test_api_key" | Диалог создан с chat_id = "test_chat_1", api_key = "test_api_key", confirmed = False, language = "en", subscription_status = "free" |
| Б5 | Проверка обновления параметров диалога | update_dialog | chat_id = "test_chat_2", api_key = "test_api_key", language = "ru", subscription_status = "pro" | Параметры диалога обновлены: language = "ru", subscription_status = "pro" |
| Б6 | Проверка создания записи об ассистенте в базе данных | create_db_assistant | chat_id = "test_chat_3", api_key = "test_api_key", assistant_id = "test_assistant_1", thread_id = "test_thread_1" | Ассистент создан с assistant_id = "test_assistant_1", thread_id = "test_thread_1" |
| Б7 | Проверка получения списка идентификаторов ассистентов для диалога | get_dialog_assistants_ids | chat_id = "test_chat_4", api_key = "test_api_key", несколько ассистентов с assistant_id = "test_assistant_0..2", thread_id = "test_thread_0..2" | Возвращается список идентификаторов всех созданных ассистентов |
| Б8 | Проверка удаления ассистента из базы данных | delete_db_assistant | chat_id = "test_chat_5", api_key = "test_api_key", assistant_id = "test_assistant_1", thread_id = "test_thread_1" | Ассистент удалён, попытка получения ассистента вызывает ValueError |
| Б9 | Проверка экранирования строки, начинающейся с точки | add_character_before_special | string = ".ertyuj" | Возвращается строка "\\.ertyuj" |
| Б10 | Проверка экранирования строки, заканчивающейся точкой | add_character_before_special | string = "ertyuj." | Возвращается строка "ertyuj\\." |
| Б11 | Проверка экранирования строки с двумя точками | add_character_before_special | string = "ertyuj.." | Возвращается строка "ertyuj\\.\\." |
| Б12 | Проверка экранирования строки только со специальными символами | add_character_before_special | string = "*_[]{}" | Возвращается строка "\\*\\_\\[\\]\\{\}" |
| Б13 | Проверка экранирования пустой строки | add_character_before_special | string = "" | Возвращается пустая строка "" |
| Б14 | Проверка экранирования строки с числовыми значениями | add_character_before_special | string = "-3.5" | Возвращается строка "\\-3\\.5" |
| Б15 | Проверка создания нового диалога | create_dialog | user_id = "1236" | Диалог создан с user_id = "1236", confirmed = False, language = "en", subscription_status = "free", current_assistant_id = "", current_llm_id = "llm_1", assistants_list = [], llm_list = ["llm_1", "llm_2", "llm_3", "llm_4"], save_context = 1 |
| Б16 | Проверка получения информации о новом диалоге | get_dialog | user_id = "1235" | Возвращается словарь с user_id = "1235", language = "en", subscription_status = "free", current_assistant_id = "", current_llm_id = "llm_1", assistants_list = [], llm_list = ["llm_1", "llm_2", "llm_3", "llm_4"], save_context = 1 |
| Б17 | Проверка изменения параметров нового диалога | update_dialog | user_id = "1234", language = "ru", subscription_status = "pro", current_llm_id = "llm_2", save_context = 0, assistants_list = ["as_1"] | Параметры диалога обновлены: language = "ru", subscription_status = "pro", current_llm_id = "llm_2", save_context = 0, assistants_list = ["as_1"] |

План интеграционного тестирования
| ID  | Описание теста | Объект тестирования | Входные данные | Ожидаемый результат |
|-----|----------------|---------------------|----------------|---------------------|
| И1  | Проверка создания ассистента в системе с корректными параметрами | create_assistant | chat_id = "test_chat_1", api_key = "test_api_key", name = "Test Assistant", instructions = "Test instructions" | Создан ассистент с id = "test_assistant_id", name = "Test Assistant", instructions = "Test instructions" |
| И2  | Проверка обновления параметров существующего ассистента | update_assistant | chat_id = "test_chat_2", api_key = "test_api_key", assistant_id = "test_assistant_id", new_name = "Updated Assistant", new_instructions = "Updated instructions" | Ассистент обновлён с name = "Updated Assistant", instructions = "Updated instructions" |
| И3  | Проверка удаления ассистента из системы | delete_assistant | chat_id = "test_chat_3", api_key = "test_api_key", assistant_id = "test_assistant_id" | Ассистент удалён, возвращено deleted = True, попытка получения ассистента вызывает ValueError |
| И4  | Проверка получения данных об ассистенте по его идентификатору | get_assistant | chat_id = "test_chat_4", api_key = "test_api_key", assistant_id = "test_assistant_id" | Возвращены данные ассистента с id = "test_assistant_id", name = "Test Assistant", instructions = "Test instructions" |
| И5  | Проверка добавления токенов на баланс пользователя | add_tokens | chat_id = "test_chat_3", api_key = "test_api_key", amount = 1000 | Возвращается результат с success = True, tokens = 1000 |
| И6  | Проверка получения текущего баланса пользователя | get_balance | chat_id = "test_chat_4", api_key = "test_api_key" | Возвращается результат с balance = 1000 |


План аттестационного тестирования

| ID  | Описание теста | Объект тестирования | Входные данные | Ожидаемый результат |
|-----|----------------|---------------------|----------------|---------------------|
| А1  | Проверка выбора текущего активного ассистента | Модуль «Мои Ассистенты» (/my_assistants) | Нажатие на кнопку с именем ассистента (активного или неактивного) | Для неактивного ассистента: ассистент становится активным, сообщение модуля удаляется, выводится сообщение о смене ассистента. Для активного ассистента: сообщение модуля удаляется, настройки не изменяются. |
| А2  | Проверка добавления нового ассистента | Модуль «Мои Ассистенты» (/my_assistants) | Нажатие на кнопку «Создать ассистента», ввод имени и инструкций | Новый ассистент создан, становится активным, выводится сообщение о создании с кнопкой перехода в модуль «Мои Ассистенты». |
| А3  | Проверка изменения названия ассистента | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «Название», ввод нового названия | Название ассистента обновлено, выводится сообщение об изменении с текущим значением. |
| А4  | Проверка изменения описания ассистента | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «Описание», ввод нового описания | Описание ассистента обновлено, выводится сообщение об изменении с текущим значением. |
| А5  | Проверка изменения инструкций ассистента | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «Инструкции», затем «Изменить инструкции», ввод новых инструкций | Инструкции ассистента обновлены, выводится сообщение об обновлении. |
| А6  | Проверка удаления инструкций ассистента | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «Инструкции», затем «Удалить инструкции» | Инструкции ассистента удалены, выводится сообщение об удалении. |
| А7  | Проверка изменения параметра температуры ответов | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «Температура ответов», ввод нового значения | Параметр температуры обновлён, выводится сообщение об изменении с текущим значением. |
| А8  | Проверка изменения параметра top_p | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «top_p», ввод нового значения | Параметр top_p обновлён, выводится сообщение об изменении с текущим значением. |
| А9  | Проверка выбора базы знаний для ассистента | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «Базы знаний», выбор активной или неактивной базы | Активная база отключается, неактивная подключается, настройки ассистента обновлены. |
| А10 | Проверка добавления базы знаний | Модуль «Инструкции и знания» (/assistant_settings) | Нажатие на кнопку «Добавить базу», ввод названия, загрузка .txt файлов, команда /done | Создано векторное хранилище данных, база доступна для ассистента. |
| А11 | Проверка изменения текущей LLM-модели | Модуль «Сменить модель» (/change_model) | Нажатие на кнопку с названием модели (активной или неактивной) | Для неактивной модели: модель становится активной, настройки ассистента обновлены, сообщение модуля удаляется, выводится сообщение о смене модели. Для активной модели: сообщение модуля удаляется, настройки не изменяются. |
| А12 | Проверка вывода текущего количества токенов | Модуль «Баланс и расходы» (/billing) | Переход в раздел «Баланс и расходы» | Выводится сообщение с текущим количеством токенов, кнопками «Пополнить баланс» и «История пополнений». |
| А13 | Проверка вывода истории пополнений | Модуль «Баланс и расходы» (/billing) | Нажатие на кнопку «История пополнений» | Выводится сообщение с информацией о последних 20 пополнениях: дата, тариф, стоимость. |
| А14 | Проверка вывода списка тарифов для покупки токенов | Модуль «Баланс и расходы» (/billing) | Нажатие на кнопку «Пополнить баланс» | Выводится сообщение с доступными тарифами и кнопками, при нажатии на которые отправляется ссылка на оплату. |
| А15 | Проверка подтверждения оплаты | Модуль «Баланс и расходы» (/billing) | Нажатие на кнопку «Подтвердить оплату» в сообщении с ссылкой | Проверяется статус инвойса, выводится сообщение с результатом оплаты. |
| А16 | Проверка вывода сообщения с основными командами | Модуль «Помощь» (/help) | Вызов команды /help | Выводится сообщение с описанием основных команд, ссылкой на чат поддержки и кнопкой «Написать в поддержку». |
| А17 | Проверка перенаправления в чат технической поддержки | Модуль «Помощь» (/help) | Нажатие на кнопку «Написать в поддержку» | Происходит перенаправление в чат технической поддержки через открытие ссылки. |

